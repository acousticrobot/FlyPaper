/*! FlyPaper 21-02-2013 */
var fly=void 0===fly?{}:fly;if("object"!=typeof fly)throw Error("fly is not an object!");fly.name="flypaper",fly.version="0.5beta","function"!=typeof Object.create&&(Object.create=function(e){var t=function(){},i=typeof e;if("object"!==i&&"function"!==i)throw new TypeError;return t.prototype=e,new t}),fly.toString=function(e,t,i){e=e||this;var r,n="",o="",s=!1;e instanceof Array?(n+="[",s=!0,o="]"):"object"==typeof e&&(n+="{",o="}"),t=t||0,i=i||0;for(r in e)e.hasOwnProperty(r)&&(s||"function"==typeof e[r]||(n+='"'+r+'":'),n+="function"==typeof e[r]?r+"()":"object"==typeof e[r]?t>i?fly.toString(e[r],t,i+1):"object":"string"==typeof e[r]?'"'+e[r]+'"':e[r],n+=",");return n.length>1&&(n=n.slice(0,-1)),n+=o},fly.grantString=function(e){return e.toString=function(e){return fly.toString(this,e,0)},e},fly.grantInfo=function(e){function t(e,t,i){var r,o,s,l=!1;i===n&&(l=!0);for(r in i)i[r].val&&i[r].type&&(o=i[r].val,s=i[r].type,l&&("val"===s||"bool"===s?o=e[o]:s.match(/^f$|func|function/)&&(o=e[o](),s="val"),(o===!0||o===!1)&&(s="bool")),t[r]={val:o,type:s});return t}var i=e.name||fly.name,r=e.version||fly.version,n={version:{val:r,type:"version"}};return e.addInfo=function(i){return t(this,n,i),e},e.deleteInfo=function(t){if("string"==typeof t)delete n[t];else if(t instanceof Array)for(var i=0;t.length>i;i++)t[i]in n&&delete n[t[i]];return e},e.info=function(){var e={};return e.name=i,e=t(this,e,n)},e},fly.grantEvents=function(e){var t={};return e.registerEvent=function(i){for(var r in i)i.hasOwnProperty(r)&&(t.hasOwnProperty(r)||fly.eventCtrlr.subscribe(r,e),t[r]=i[r]);return e},e.deregisterEvent=function(i){var r,n=function(i){t.hasOwnProperty(i)&&(delete t[i],fly.eventCtrlr.unsubscribe(i,e))};if("string"==typeof i)if("all"===i)for(r in t)t.hasOwnProperty(r)&&n(r);else n(i);else for(r in i)i.hasOwnProperty(r)&&n(r)},e.eventCall=function(i,r){if(t.hasOwnProperty(i)&&e.hasOwnProperty(t[i])){var n=t[i];this[n](r)}return e},e.logEvents=function(){return fly.toString(t)},e},fly.base=function(e){var t={};return t.name=e||"fly base",t.version="0.5beta",t.register=function(){return fly.infoCtrlr.register(this),this},fly.grantString(t),fly.grantInfo(t),fly.grantEvents(t),t},fly.eventCtrlr=function(){function e(e){var t;for(t in h)h[t]>0&&(h[t]=h[t]-1);h[e]=p}function t(t,i){if(fly.debug&&(e(t),t.match(c)&&(y=t)),f[t])for(var r=0;f[t].length>r;r++)try{void 0!==i?f[t][r].eventCall(t,i):f[t][r].eventCall(t)}catch(n){s(n,f[t][r])}}function i(e,t){"string"==typeof e&&(e=[e]);for(var i=0,r=e.length;r>i;i++)f[e[i]]?f[e[i]].push(t):(f[e[i]]=[t],h[e[i]]=p)}function r(e,t){var i=function(e){for(var i=0,r=f[e].length;r>i;i++)f[e][i]===t&&f[e].splice(i,1),0===f[e].length&&delete f[e]};if("all"===e)for(var r in f)f.hasOwnProperty[r]&&i(r);else f.hasOwnProperty(e)&&i(e)}function n(){fly.infoCtrlr.register(this)}function o(){var e,t,i={name:l,v:{val:a,type:"version"},errors:{val:u.length,type:"val"}};for(e in f)if(f.hasOwnProperty(e)){t=h[e]>0?"eventFiring":"event";var r=f[e].length>1?" subscribers":" subscriber";i[e]={val:f[e].length+r,type:t}}return i.last_key={val:y,type:"string"},i}function s(e,t){var i="Error: ";"TypeError: events[e][i].eventCall is not a function"===e&&(t.info().name&&(i+=t.info().name),i+=" has no event call");for(var r=0;u.length>r;r++)if(u[r]===i)return;u.push(i)}var l="eventCtrlr",a="0.5beta",f={},h={},p=10,c=/.*-key$/,y="",u=[];return{publish:t,subscribe:i,unsubscribe:r,info:o,reqInfo:n,logErrors:function(){return fly.toString(u)},logEvents:function(){return fly.toString(f)}}}(),fly.grantString(fly.eventCtrlr),fly.initLayers=function(e,t){fly.layers={name:"layers",version:"0.5beta"},fly.layers.names=function(e,t){var i,r=t?["background"]:[];if("number"==typeof e)for((1>e||e>100)&&(e=1),i=0;e>i;i++)r.push("stage "+r.length);else if(e instanceof Array)for(i=0;e.length>i;i++)"string"==typeof e[i]?r.push(e[i]):r.push("stage-"+r.length);return r}(e,t),fly.layers.stage=function(){var e,t=[];for(e=0;fly.layers.names.length>e;e++)t[e]=0===e?paper.project.activeLayer:new paper.Layer;return t}();var i=new paper.Layer;fly.layers.stage.push(i),fly.layers.names.push("info"),fly.layer=function(e){return"number"==typeof e&&fly.layers.stage[e]?fly.layers.stage[e]:"string"==typeof e&&fly.layers.names.indexOf(e)>-1?fly.layers.stage[fly.layers.names.indexOf(e)]:!1},fly.layers.activate=function(e){fly.layer(e).activate()},fly.layers.info=function(){var e={},t=0,i=function(e){var t,i;return t=e.children.length,t+=1===t?" child":" children",i=e===paper.project.activeLayer?"btrue":"string","btrue"===i&&(t+=" <active>"),{val:t,type:i}};for(e.name=this.name,t=0;fly.layers.names.length>t;t++)e[fly.layers.names[t]]=i(fly.layers.stage[t]);return e},fly.layers.toString=function(){var e,t="[";for(e=0;this.names.length>e;e++)t+='"'+this.names[e]+'",';return t=t.slice(0,-1),t+="]"}},fly.color={name:"color",palette:"not yet defined"},fly.colorUtil={limit:function(e){return e=Math.min(Math.max(e,0),255)},split:function(e){var t=e.slice(1);t=parseInt(t,16);var i=t>>16,r=255&t>>8,n=255&t;return[i,r,n]},splice:function(e){for(var t=e[0],i=e[1],r=e[2],n=(t<<16|i<<8|r).toString(16);6>n.length;)n="0"+n;return n="#"+n},mix:function(e,t,i){i=void 0!==i?i:.5;for(var r=this.split(e),n=this.split(t),o=0;r.length>o;o++)r[o]=r[o]*(1-i)+n[o]*i;return this.splice(r)},totalValue:function(e){var t=this.split(e);return t[0]+t[1]+t[2]},bispectrum:function(e,t,i){if(i=void 0!==i?i:5,3>i)return[e,t];for(var r=[e],n=1;i-1>n;n++)r.push(this.mix(e,t,n/(i-1)));return r.push(t),r},trispectrum:function(e,t,i,r){r=void 0!==r?r:9;var n=Math.ceil(r/2),o=this.bispectrum(e,t,n),s=this.bispectrum(t,i,n);o.pop();var l=o.concat(s);return l},spectrum:function(e,t,i,r,n){fly.colorSets.push(e);var o;return void 0!==r&&("string"==typeof r?o=this.trispectrum(t,i,r,n):"number"==typeof r?o=this.bispectrum(t,i,r):n=this.bispectrum(t,i)),o},background:function(e){if(!e)return fly.layers.backRect?fly.layers.backRect.fillColor:"none set";if(fly.layers&&fly.layer("background")){if(void 0===fly.layers.backRect){var t=paper.project.activeLayer;fly.layers.activate("background"),fly.layers.backRect=new paper.Path.Rectangle(paper.view.bounds),t.activate()}e=void 0!==e?e:"#FFFFFF",fly.layers.backRect.fillColor=e}}},fly.colorSets=[{name:"default",set:[["red","#400000","#FF0000","#FFC0C0"],["orange","#402900","#FFA500","#FFE8C0"],["yellow","#404000","#FFFF00","#FFFFC0"],["green","#004000","#00FF00","#C0FFC0"],["blue","#000040","#0000FF","#C0C0FF"],["purple","#400040","#800080","#FFC0FF"],["grey","#000000","#808080","#FFFFFF"]]},{name:"pastel",set:[["red","#F04510","#FF7070","#FFD3C0"],["orange","#F28614","#FFB444","#FFE8C0"],["yellow","#CDB211","#FFFF70","#FFFFC0"],["green","#42622D","#89C234","#C0FFC0"],["blue","#00597C","#00A9EB","#B0E5FF"],["purple","#6F006F","#9F3DBF","#FFC0FF"],["grey","#383633","#A7A097","#FFFFFF"]]},{name:"sunny day",set:[["red","#2F060D","#FF361F","#FFCFC5"],["orange","#6D3200","#FF8125","#FFD1B6"],["yellow","#D6FF43","#FFFA95","#F4FFDA"],["green","#3B4D2A","#89C234","#A0FFA0"],["blue","#1D3852","#00A9EB","#9BCAE1"],["purple","#4C244C","#893DB3","#D0B8FF"],["grey","#1E2421","#848179","#D3FFE9"]]},{name:"monotone",set:[["red","#1B1414","#584444","#FFE7E3"],["orange","#2A2620","#4D463A","#FFE9CC"],["yellow","#313125","#808061","#FAFFE0"],["green","#111611","#6E936E","#E7FFD3"],["blue","#0A0A0D","#696991","#E5D9FF"],["purple","#0D090D","#684E68","#FFE3EC"],["grey","#000000","#808080","#FFFFFF"]]},{name:"neon",set:[["red","#6A0032","#FF0023","#FFC0F2"],["orange","#BD2E00","#FFA500","#FFE8C0"],["yellow","#ACFF02","#FFFF00","#FFFFC0"],["green","#133B0F","#38FF41","#BFFF68"],["blue","#010654","#013BFF","#4FFFF8"],["purple","#3B034C","#9800B3","#CC5FFF"],["grey","#0A0511","#696281","#E3E8FF"]]}],fly.colorPalette=function(e){function t(e){if(!e.name||!e.set)return"Palette must have a name and a set";if("string"!=typeof e.name)return"Palette name must be string";if(e.set instanceof Array==!1)return"Palette set must be an array";for(s=0;e.set.length>s;s++){if(e.set[s]instanceof Array==!1||4!==e.set[s].length)return"Palette set of unknown type";var t=/palette|info|addInfo|deleteInfo/;if(e.set[s][0].match(t))return e.set[s][0]+" is a reserved word in color sets"}return!0}function i(e){for(s=0;fly.colorSets.length>s;s++)if(fly.colorSets[s].name===e)return s;return-1}function r(){var r;if("object"==typeof e&&e.name&&e.set){if(r=t(e),r!==!0)throw new TypeError(r);l=i(e.name),-1===l?(l=fly.colorSets.length,fly.colorSets.push(e)):fly.colorSets[l].set=e.set}else{if("string"!=typeof e)return new TypeError("Unknown type sent as args to color palette");l=i(e),-1===l&&(l=0)}}function n(e){fly.color={name:"color",palette:e.name};for(var t,i,r={palette:{val:"palette",type:"val"}},n=0;e.set.length>n;n++)t=e.set[n],i=t[1]+"-"+t[2]+"-"+t[3],r[t[0]]={val:i,type:"string"};fly.grantInfo(fly.color).addInfo(r)}function o(){var e,t;try{r()}catch(i){if("not yet defined"!==fly.color.palette)return i;l=0}for(t=fly.colorSets[l],n(t),s=0;t.set.length>s;s++)e=t.set[s],fly.color[e[0]]=fly.colorUtil.spectrum(e[0],e[1],e[2],e[3])}var s,l=-1;return e?(o(),void 0):fly.color.palette},fly.infoCtrlrInit=function(e){var t,i;fly.infoCtrlr=function(e){function t(e,t){t=t!==void 0?t:!1;for(var i=0;w.length>i;i++)if(w[i].obj===e)return"error: object already exists";w.push({obj:e,display:t,info:{}}),g(!0),s()}function i(e){for(var t=0;w.length>t;t++)if(w[t].obj===e)return w.splice(t,1),void 0;r()}function r(){k.txtWidth=0,g(!0),s()}function n(e,t){if(void 0===e||void 0===t)return"Error printing info";d(e,t);var i=new paper.PointText(k.cursor);i.paragraphStyle.justification="left",i.characterStyle.fontSize=x.size;var r="";if("openTitle"===t)r+="▼  "+e,i.fillColor=x.titles;else if("closedTitle"===t)r+="▶ "+e,i.fillColor=x.titles,k.cursor.y+=2;else{var n;n="bool"===t.type?"b"+t.val:t.type,i.fillColor=void 0!==x[n]?x[n]:x.plain,r+=e+": "+t.val}i.content=r,B.txt.addChild(i),k.cursor.y+=x.spacing}function o(){k.cursor=new paper.Point(k.txtOrigin);for(var e=0;w.length>e;e++)if(l(),w[e].display===!0){n(w[e].info.name,"openTitle");for(var t in w[e].info)"name"!==t&&n(t,w[e].info[t])}else n(w[e].info.name,"closedTitle")}function s(){k.titleBars=[]}function l(){if(k.titleBars.length!==w.length){var e=new paper.Point(k.cursor.x-x.offset,k.cursor.y-1.2*x.offset);k.titleBars.push(e)}}function a(){for(var e=0;k.titleBars.length>e;e++){var t=new paper.Size(k.txtWidth+2*x.offset,x.spacing),i=new paper.Path.Rectangle(k.titleBars[e],t);i.fillColor=x.screenBars,i.opacity=.5,B.bars.addChild(i)}}function f(){var e=new paper.Size(k.boxWidth,30),t=new paper.Path.Rectangle(k.origin,e);t.name="grip",t.fillColor=x.plain,t.visible=!1,B.box.addChild(t);for(var i=0;7>i;i++){var r=new paper.Point(k.origin.x,k.origin.y+.3*x.size*i+2),n=new paper.Point(r.x+k.boxWidth,r.y),o=new paper.Path.Line(r,n);o.strokeColor=x.screenBars,o.strokeWidth=2,B.box.addChild(o)}}function h(){k.txtWidth=.68*k.txtLen*x.size,k.boxWidth=k.txtWidth+2*x.offset;var e=new paper.Size(k.boxWidth,k.cursor.y-k.origin.y-x.offset),t=new paper.Rectangle(k.origin,e),i=new paper.Path.RoundRectangle(t,10),r=new paper.Path.Rectangle(t);r.fillColor=x.screen,r.opacity=x.opacity,B.box.addChild(i),B.box.addChild(r),B.box.clipped=!0,f(),a(),fly.layer("info").visible=k.visible}function p(){fly.debug&&(k.visible=!k.visible,(1>k.origin.x||k.origin.x>fly.height||1>k.origin.y||k.origin.y>fly.width)&&(k.origin.x=10,k.origin.y=10,k.txtOrigin=k.origin.add(k.txtOffset),s()))}function c(e){var t=e.point;if(fly.layer("info").visible){for(var i=0;B.bars.children.length>i;i++)B.bars.children[i].hitTest(t)&&(w[i].display=!w[i].display,r());B.box.children.grip.hitTest(t)&&(k.handle.or=t.subtract(k.origin),E=!0)}}function y(e){var t=e.point;E&&(k.origin=t.subtract(k.handle.or),k.txtOrigin=k.origin.add(k.txtOffset),s())}function u(e){e.point,E=!1}function d(e,t){e=e||0,t=t||0,e=""+e||0,t=""+t||0;var i=e.length+t.length;i>k.txtLen&&(k.txtLen=i),k.txtLen>50&&(k.txtLen=50)}function v(e){j.frame=e.count,j.time=e.time,e.time-j.refresh>.1&&(j.refresh=e.time,j.fps.avg=j.frame/j.time,j.fps.curr=1/e.delta)}function g(e){for(var t=0;w.length>t;t++)if((w[t].display||e)&&(w[t].info=w[t].obj.info(),e)){var i;for(i in w[t].info)if(w[t].info.hasOwnProperty(i))try{"name"===i?d("name",w[t].info.name):d(i,w[t].info[i].val)}catch(r){return r}}}function b(e){v(e),(fly.layer("info").visible||k.visible)&&(B.box.hasChildren()&&B.box.removeChildren(),B.bars.hasChildren()&&B.bars.removeChildren(),B.txt.hasChildren()&&B.txt.removeChildren(),g(),o(),h())}var m="Info Controller",F="0.5beta",w=[{obj:fly,display:!1},{obj:fly.eventCtrlr,display:!1},{obj:fly.layers,display:!1},{obj:fly.color,display:!1}];e=e||{},"not yet defined"===fly.color.palette&&fly.colorPalette("default");for(var C=e.keyTrigger||"i-key",x={},P=!0,A=["blue","grey","green","orange","red","purple"],S=0;A.length>S;S++)if(!fly.color[A[S]]||8>fly.color[A[S]].length){P=!1;break}P?(x.titles=e.titleBar||fly.color.blue[7],x.plain=fly.color.grey[4]||"#89C234",x.screen=e.screen||fly.color.grey[1],x.screenBars=e.screenBars||fly.color.grey[0],x.val=e.val||fly.color.green[2],x.string=e.string||fly.color.grey[4],x.btrue=e.btrue||fly.color.orange[6],x.bfalse=e.bfalse||fly.color.orange[3],x.event=e.event||fly.color.red[4],x.eventFiring=e.eventFiring||fly.color.red[7],x.version=e.version||fly.color.grey[5],x.info=e.info||fly.color.blue[7]):(x.titles=e.titleBar||"#9BCAE1",x.plain="#89C234",x.screen=e.screen||"#0D1927",x.screenBars=e.screenBars||"black",x.val=e.val||"#89C234",x.string=e.string||"#691BE2",x.btrue=e.btrue||"#66FF99",x.bfalse=e.bfalse||"#3D9199",x.event=e.event||"#BC4500",x.eventFiring=e.eventFiring||"#FF5E00",x.version=e.version||"#8A8A39",x.info=e.info||"#CCB599"),x.size=e.size||11,x.spacing=1.75*x.size,x.offset=x.size,x.opacity=e.opacity||.95;var k={};k.handle={},k.origin=new paper.Point(10,10),k.txtOffset=[x.size,3.5*x.size],k.txtOrigin=k.origin.add(k.txtOffset),k.txtLen=0,k.txtWidth=0,k.titleBars=[],k.visible=fly.debug;var B=[];B.box=new paper.Group,B.bars=new paper.Group,B.txt=new paper.Group;var E=!1,j={};j.refresh=0,j.frame=0,j.time=0,j.fps={curr:0,avg:0};var z={};return z.isIpad=null!==navigator.userAgent.match(/iPad/),z.isMobile=function(){var e=navigator.userAgent.toLowerCase(),t=/android|webos|iphone/;return e.match(t)?!0:!1}(),{name:m,version:F,"key trigger":C,members:w,numMembers:function(){return w.length},frame:function(){return j.frame},time:function(){return j},"time passed":function(){return j.time.toFixed(1)},fps:function(){return j.fps.curr.toFixed(1)},fpsAvg:function(){return j.fps.avg.toFixed(1)},moving:function(){return E},isMobile:function(){return z.isMobile},isIpad:function(){return z.isIpad},update:b,register:t,deregister:i,toggleDisplay:p,grab:c,drag:y,drop:u}}(e),fly.grantString(fly.infoCtrlr),fly.grantInfo(fly.infoCtrlr).addInfo({"key trigger":{val:"key trigger",type:"val"},members:{val:"numMembers",type:"func"},"time passed":{val:"time passed",type:"func"},"frames per second":{val:"fps",type:"func"},"fps average":{val:"fpsAvg",type:"func"},mobile:{val:"isMobile",type:"func"},ipad:{val:"isIpad",type:"func"}}),fly.infoCtrlr.register(fly.infoCtrlr),t={frame:"update","mouse down":"grab","mouse drag":"drag","mouse up":"drop"},i=fly.infoCtrlr["key trigger"],t[i]="toggleDisplay",fly.grantEvents(fly.infoCtrlr).registerEvent(t),fly.infoCtrlr.toggleDisplay()},fly.initPaperTool=function(){fly.tool=new paper.Tool,fly.tool.onKeyDown=function(e){var t="";1===e.key.length&&(e.modifiers.shift===!0&&(t+="shift-"),e.modifiers.control===!0&&(t+="control-"),e.modifiers.option===!0&&(t+="option-"),e.modifiers.command===!0&&(t+="command-"),e.modifiers.capsLock===!0&&(t+="capsLock-")),t+=e.key+"-key",fly.eventCtrlr.publish(t)},fly.tool.onMouseDown=function(e){fly.eventCtrlr.publish("mouse down",e)},fly.tool.onMouseDrag=function(e){fly.eventCtrlr.publish("mouse drag",e)},fly.tool.onMouseUp=function(e){fly.eventCtrlr.publish("mouse up",e)},fly.tool.onMouseMove=function(e){fly.eventCtrlr.publish("mouse move",e)}},fly.init=function(e){void 0===e&&(e={}),fly.debug=e.debug||!1;var t=e.layers||1,i=e.background||!0,r=e.colorPalette||"default",n=e.infoPrefs||{};e.width&&e.height?(fly.width=e.width,fly.height=e.height,paper.view.viewSize=new paper.Size(fly.width,fly.height)):(fly.width=paper.view.viewSize.width,fly.height=paper.view.viewSize.height),fly.foo="foo",fly.grantInfo(fly).addInfo({debug:{val:"debug",type:"val"},width:{val:"width",type:"val"},height:{val:"height",type:"val"}}),fly.initLayers(t,i),fly.colorPalette(r),fly.infoCtrlrInit(n),fly.layer("background")?fly.layers.activate(1):fly.layers.activate(0),fly.initPaperTool()},fly.midpoint=function(e,t){var i=new paper.Point(e.add(t));return i=i.divide([2,2])},fly.scatter=function(e,t){e instanceof Array==!1&&(e=[e]);for(var i=0;e.length>i;i++){var r=new paper.Point(t.width,t.height),n=r.multiply(paper.Size.random());e[i].position=t.point.add(n)}},fly.randomizePt=function(e,t,i){var r=i||"none";if("y"!==r){var n=-t+2*t*Math.random();e.x+=n}if("x"!==r){var o=-t+2*t*Math.random();e.y+=o}return e},fly.eachCell=function(e,t){for(var i=0;e.cols>i;i++)for(var r=0;e.rows>r;r++)t(e,i,r)},fly.gridPlot=function(e,t,i,r){r=r||"down-left";for(var n=new paper.Path.Rectangle(i),o=[],s=0;e>=s;s++)o[s]=[];for(var l=n.bounds.width/e,a=n.bounds.height/t,f=0;e>=f;f++)for(var h=0;t>=h;h++){var p=new paper.Point(n.bounds.x+f*l,n.bounds.y+h*a);switch(r){case"down-right":case"right":o[e-f][h]=p;break;case"up-left":o[f][t-h]=p;break;case"up-right":o[e-f][t-h]=p;break;default:o[f][h]=p}}return o},fly.initArray=function(e,t){for(var i=[],r=0;e>r;r++){i[r]=[];for(var n=0;t>n;n++)i[r][n]=[]}return i},fly.Scroll=function(e){e=e||{},this.name=e.name+" scroll"||"scroll",this.version="0.4 Beta",this.position=e.position||new paper.Point(0,0),this.direction=e.direction||"left",this.speed=void 0!==e.speed?e.speed:5,this.curSpeed=0,this.repeat=e.repeat||!0,this.reset=!1,this.resetAt=e.resetAt||fly.width,this.resetPos=e.resetPos||this.position,this.register()},fly.Scroll.prototype.info=function(){var e={};return e.name=this.name,e.version={val:this.version,type:"version"},e.position={val:this.position,type:"val"},e.speed={val:this.speed,type:"val"},e.curSpeed={val:this.curSpeed,type:"val"},e.direction={val:this.direction,type:"val"},e.repeat={val:this.repeat,type:"bool"},e.reset={val:this.reset,type:"bool"},e},fly.Scroll.prototype.register=function(){fly.debug&&fly.infoCtrlr.register(this)},fly.Scroll.prototype.update=function(e){switch(this.curSpeed=8*e.delta*this.speed,this.direction){case"up":this.position.y-=this.curSpeed,this.position.y<this.resetAt&&(this.reset=!0);break;case"down":this.position.y+=this.curSpeed,this.position.y>this.resetAt&&(this.reset=!0);break;case"right":this.position.x-=this.curSpeed,this.position.x<this.resetAt&&(this.reset=!0);break;default:this.position.x+=this.curSpeed,this.position.x>this.resetAt&&(this.reset=!0)}this.reset===!0&&(this.position=new paper.Point(this.resetPos),this.reset=!1)},fly.Scroll.prototype.reposition=function(e){this.position=new paper.Point(e)},fly.Bob=function(e){e=e||{},this.name=e.name+"'s motion: bob"||"bob",this.version="0.4",this.position=new paper.Point(e.position)||new paper.Point(0,0),this.origin=new paper.Point(this.position),this.speed=void 0!==e.speed?e.speed:5,this.delta=void 0!==e.delta?e.delta:33,this.register()},fly.Bob.prototype.info=function(){var e={};return e.name=this.name,e.version={val:this.version,type:"version"},e.position={val:"x: "+this.position.x.toFixed(0)+", y: "+this.position.y.toFixed(0),type:"val"},e.speed={val:this.speed,type:"val"},e.delta={val:this.delta,type:"val"},e},fly.Bob.prototype.register=function(e){fly.debug&&(e=e||!1,fly.infoCtrlr.register(this,e))},fly.Bob.prototype.reposition=function(e){this.position=new paper.Point(e)},fly.Bob.prototype.move=function(e){this.origin=new paper.Point(e)},fly.Bob.prototype.update=function(e){var t=new paper.Point(this.origin),i=Math.sin(e.time*this.speed)*this.delta;t.y+=i,this.reposition(t)},fly.Swing=function(e){e=e||{name:"",maxRotation:90,decay:0,timestep:.01},this.name=e.name+" swing"||"swing",this.version="0.3.3",this.maxR=e.maxRotation||90,this.decay=1+e.decay/1e3||1,this.velocity=3,this.angle=0,this.deg=0,this.gravity=10,this.l=1,this.k=-this.gravity/this.l,this.timestep=e.timestep||1e-4,this.acceleration=0,this.register()},fly.Swing.prototype.info=function(){var e={};return e.name=this.name,e.version={val:this.version,type:"version"},fly.debug&&(e.length={val:this.l.toFixed(2),type:"val"},e.timestep={val:this.timestep.toFixed(3),type:"val"},e.decay={val:this.decay,type:"val"},e.velocity={val:this.velocity.toFixed(0),type:"val"},e.angle={val:this.angle.toFixed(0),type:"val"},e.degree={val:this.deg.toFixed(0),type:"val"},e.acceleration={val:this.acceleration.toFixed(0),type:"val"}),e},fly.Swing.prototype.add=function(){this.velocity>0?this.velocity+=this.force/10:0>this.velocity&&(this.velocity-=this.force/10)},fly.Swing.prototype.update=function(){this.acceleration=this.k*Math.sin(this.angle),this.velocity+=this.acceleration*this.timestep,this.angle+=this.velocity*this.timestep,this.decay&&(this.velocity/=this.decay)},fly.Swing.prototype.rotation=function(){return this.deg=this.angle*this.maxR,this.deg>0&&this.deg>this.maxR?(this.deg=this.maxR,this.velocity=0):0>this.deg&&this.deg<-this.maxR&&(this.deg=-this.maxR,this.velocity=0),this.deg.toFixed(2)},fly.Ananda=function(){void 0===this.version&&(this.version="0.3.6"),void 0===this.name&&(this.name="Ananda ")},fly.Ananda.prototype.init=function(e){function t(){void 0===f.Pt&&(f.Pt=new paper.Point(0,0)),void 0===f.Sz&&(f.Sz=new paper.Size(f.ds,f.ds)),void 0===f.Rect&&(f.Rect=new paper.Rectangle(f.Pt,f.Sz)),f.handle=new paper.Path.Rectangle(f.Rect),f.handle.selected=!1,f.handle.style=f.style||{fillColor:"white"},f.handle.visible=f.visible||!1}function i(i){0>e?(f.n="born",f.Sz=new paper.Size(100,100),t()):(f.n="Numborn",f.Sz=new paper.Size(i,i),t()),f.bld+="n("+i+")"}function r(e){f.n=e,f.bld+="s("+e+")"}function n(e){switch(f.n="NArrborn",f.bld+="a[",e.length){case 0:return;case 1:return f.bld+=e[0],i(e[0]),void 0;case 2:f.bld+=e[0]+"."+e[1],f.Sz=new paper.Size(e[0],e[1]);break;case 3:f.bld+=e[0]+"."+e[1]+"."+e[2],f.Pt=new paper.Point(e[0],e[1]),f.Sz=new paper.Size(e[2],e[2]);break;case 4:f.bld+=e[0]+"."+e[1]+"."+e[2]+"."+e[3],f.Pt=new paper.Point(e[0],e[1]),f.Sz=new paper.Size(e[2],e[3])}f.bld+="]",t()}function o(e){for(var t=!0,i=0;e.length>i;i++)if("number"!=typeof e[i]){t=!1;break}t?n(e):f.n="errorArray"}function s(e){f.Rect=new paper.Rectangle(e)}function l(e){"number"==typeof e?i(e):e instanceof Array?o(e):"object"==typeof e&&void 0!==e.x&&void 0!==e.y&&void 0!==e.width&&void 0!==e.height&&s(e),t()}function a(e){e.style&&(f.style=e.style),e.visible&&(f.visible=e.visible),e.handle&&l(e.handle),e.name?r(e.name):f.n="Objborn"}e=e!==void 0?e:-1;var f={};switch(f.n="",f.bld="",f.ds=50,typeof e){case"number":i(e);break;case"string":r(e);break;case"object":e instanceof Array?o(e):a(e);break;default:f.n="errNoType"}this.name=f.n,this.buildRecord=f.bld,this.selectable=void 0!==e.selectable?e.selectable:!1,this.dragable=void 0!==e.dragable?e.dragable:!0,this.rotatable=void 0!==e.rotatable?e.rotatable:!1,this.moving=!1,this.group=new paper.Group,f.handle&&(this.handle=f.handle,this.handle.name="handle",this.group.addChild(this.handle))},fly.Ananda.prototype.info=function(){var e=this.anandaInfo();return e},fly.Ananda.prototype.anandaInfo=function(){var e={};return e.name=this.name,e.version={val:this.version,type:"version"},fly.debug&&(e.build={val:this.buildRecord,type:"string"},this.handle&&(e.point={val:this.handle.bounds.x.toFixed(2)+" x "+this.handle.bounds.y.toFixed(2),type:"val"},e.size={val:this.handle.bounds.width.toFixed(2)+" x "+this.handle.bounds.height.toFixed(2),type:"val"}),e.group={val:this.group._children.length,type:"val"},e.dragable={val:this.dragable,type:"bool"},e.moving={val:this.moving,type:"bool"},e.selectable={val:this.selectable,type:"bool"},e.selected={val:this.group.selected,type:"bool"},e.rotatable={val:this.rotatable,type:"val"}),e},fly.Ananda.prototype.register=function(e){e=e||!1,fly.infoCtrlr.register(this,e),fly.eventCtrlr.subscribe(["mouse down","mouse drag","mouse up","frame","r-key","s-key"],this)},fly.Ananda.prototype.updateHandle=function(e){var t=e||this.handle.bounds,i=this.handle.style,r=this.handle.opacity,n=this.handle.visible;this.handle.remove(),this.handle=new paper.Path.Rectangle(t),this.group.selected===!0&&(this.handle.selected=!0),this.handle.style=i,this.handle.opacity=r,this.handle.visible=n,this.group.addChild(this.handle)},fly.Ananda.prototype.toggleDisplay=function(){this.group.visible=!this.group.visible},fly.Ananda.prototype.toggleSelected=function(){fly.debug&&this.selectable&&(this.group.selected=!this.group.selected)},fly.Ananda.prototype.grab=function(e){this.handle?this.handle.hitTest(e.point)&&(this.moveOrigin=e.point.subtract(this.handle.bounds.center),this.moving=!0):this.group.hitTest(e.point)&&(this.moveOrigin=e.point.subtract(this.group.bounds.center),this.moving=!0)},fly.Ananda.prototype.drag=function(e){this.moving&&this.dragable&&fly.infoCtrlr.moving()===!1&&(this.group.position=e.point.subtract(this.moveOrigin))},fly.Ananda.prototype.drop=function(){this.moving=!1},fly.Ananda.prototype.rotate=function(e){this.rotatable&&(e=e||3,this.group.rotate(e,this.handle.bounds.center))},fly.Ananda.prototype.update=function(){},fly.Ananda.prototype.eventCall=function(e,t){switch(e){case"r-key":this.rotate();break;case"s-key":this.toggleSelected();break;case"frame":this.update(t);break;case"mouse down":this.grab(t);break;case"mouse drag":this.drag(t);break;case"mouse up":this.drop(t);break;default:}},fly.Pullbar=function(e){this.version="0.4",e=e||{},e.name=e.name+"'s pullbar"||"pullbar",void 0===e.handle&&(e.handle=10),fly.Ananda.call(this),this.init(e),this.fixLength=e.fixLength||!1,this.fixAngle=e.fixAngle||!1,this.vectorCtr=e.vectorCtr||new paper.Point(paper.view.center),this.vector=e.vector||new paper.Point(0,0),this.color=e.color||"#E4141B",this.selected=e.selected||!1,this.vectorPrevious=this.vector,this.joints=[],this.build(),this.draw(),this.moving=!1,this.register()},fly.Pullbar.prototype=new fly.Ananda,fly.Pullbar.prototype.constructor=fly.Pullbar,fly.Pullbar.prototype.info=function(){var e=this.anandaInfo(),t={};return t.name=e.name,t.moving=e.moving,t.selected={val:this.selected,type:"bool"},fly.debug&&(t.fixedLength={val:this.fixLength,type:"bool"},t.fixedAngle={val:this.fixAngle,type:"bool"},t.vectorStart={val:this.vectorCtr,type:"val"},t.vector={val:this.vector,type:"val"},this.vector&&(t.vectorLength={val:this.vector.length.toFixed(2),type:"val"},t.vectorAngle={val:this.vector.angle.toFixed(2),type:"val"}),t.vectorPrevious={val:this.vectorPrevious,type:"val"}),t},fly.Pullbar.prototype.register=function(e){e=e||!1,fly.infoCtrlr.register(this,e),fly.eventCtrlr.subscribe(["mouse down","mouse drag","mouse up","s-key"],this)},fly.Pullbar.prototype.toggleSelected=function(e){this.selected=void 0!==e?e:!this.selected,this.group.visible=this.selected},fly.Pullbar.prototype.locate=function(e){return this.vectorCtr=e||this.vectorCtr,this.joints[0]=this.vectorCtr,this.joints[1]=this.vectorCtr.add(this.vector),this.joints[2]=this.vectorCtr.subtract(this.vector),this.handle.position=this.joints[1],this.handle.bounds.center},fly.Pullbar.prototype.reposition=function(e){this.locate(e),this.draw()},fly.Pullbar.prototype.build=function(){this.locate(),this.bones=[],this.bones[0]=new paper.Path.Circle(this.joints[0],3),this.bones[1]=new paper.Path([this.joints[0],this.joints[1]]),this.bones[1].strokeWidth=1.75,this.bones[1].strokeColor="#e4141b";var e=new paper.Path.Oval(this.handle.bounds),t=e.clone();t.scale(.5,t.bounds.center),this.bones[2]=new paper.Group([e,t]),this.bones[3]=this.bones[2].clone(),this.bones[3].position=this.joints[1];for(var i=0;this.bones.length>i;i++)this.bones[i].strokeWidth=1.75,this.bones[i].strokeColor=this.color,this.bones[i].fillColor="white";this.bones[0].fillColor=this.color,this.handle.remove(),this.group.addChildren(this.bones),this.group.visible=this.visible},fly.Pullbar.prototype.processVector=function(e){this.vector=e.subtract(this.vectorCtr),this.vectorPrevious&&(this.fixLength&&this.fixAngle?this.vector=this.vectorPrevious:this.fixLength?this.vector.length=this.vectorPrevious.length:this.fixAngle&&(this.vector=this.vector.project(this.vectorPrevious))),this.locate(),this.draw()},fly.Pullbar.prototype.draw=function(){this.bones[0].position=this.joints[0],this.bones[1].segments[0].point=this.joints[1],this.bones[1].segments[1].point=this.joints[2],this.bones[2].position=this.joints[1],this.bones[3].position=this.joints[2]},fly.Pullbar.prototype.grab=function(e){this.selected&&(this.bones[2].hitTest(e.point)||this.bones[3].hitTest(e.point))&&(this.moving=!0,this.processVector(e.point))},fly.Pullbar.prototype.drag=function(e){this.moving===!0&&(!e.modifiers.shift&&this.fixLength&&this.fixAngle&&(this.vectorCtr=e.point),this.processVector(e.point))},fly.Pullbar.prototype.drop=function(e){this.moving===!0&&(this.processVector(e.point),this.vectorPrevious=this.vector,this.moving=!1)};