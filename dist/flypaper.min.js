/*!--------------------- FLYPAPER -------------------------//
 * FlyPaper - v0.4.5
 * Author: Jonathan Gabel
 * Email: post@jonathangabel.com
 * URL: http://jonathangabel.com
 * Date: 2012-11-18 20:50:17
 * https://github.com/josankapo/FlyPaper
 * Copyright (c) 2012 Jonathan Gabel;
 * Licensed MIT
 */
 //--------------------------------------------------------//

var fly=fly===undefined?{}:fly;if(typeof fly!="object")throw new Error("fly is not an object!");fly.name="flypaper",fly.version="0.5beta",typeof Object.create!="function"&&(Object.create=function(e){var t=function(){},n=typeof e;if(n!=="object"&&n!=="function")throw new TypeError;return t.prototype=e,new t}),fly.toString=function(e,t,n){e=e||this;var r="",i,s="",o=!1;e instanceof Array?(r+="[",o=!0,s="]"):typeof e=="object"&&(r+="{",s="}"),t=t||0,n=n||0;for(i in e)e.hasOwnProperty(i)&&(!o&&typeof e[i]!="function"&&(r+='"'+i+'":'),typeof e[i]=="function"?r+=i+"()":typeof e[i]=="object"?n<t?r+=fly.toString(e[i],t,n+1):r+="object":typeof e[i]=="string"?r+='"'+e[i]+'"':r+=e[i],r+=",");return r.length>1&&(r=r.slice(0,-1)),r+=s,r},fly.grantString=function(e){return e.toString=function(e){return fly.toString(this,e,0)},e},fly.grantInfo=function(e){function i(e,t,n){var i,s,o,u=!1;n===r&&(u=!0);for(i in n)if(n[i].val&&n[i].type){s=n[i].val,o=n[i].type;if(u){o==="val"||o==="bool"?s=e[s]:o.match(/^f$|func|function/)&&(s=e[s](),o="val");if(s===!0||s===!1)o="bool"}t[i]={val:s,type:o}}return t}var t=e.name||fly.name,n=e.version||fly.version,r={version:{val:n,type:"version"}};return e.addInfo=function(t){return i(this,r,t),e},e.deleteInfo=function(t){if(typeof t=="string")delete r[t];else if(t instanceof Array){var n;for(var i=0;i<t.length;i++)t[i]in r&&delete r[t[i]]}return e},e.info=function(){var e={};return e.name=t,e=i(this,e,r),e},e},fly.grantEvents=function(e){var t={};return e.registerEvent=function(n){for(var r in n)n.hasOwnProperty(r)&&(t.hasOwnProperty(r)||fly.eventCtrlr.subscribe(r,e),t[r]=n[r]);return e},e.deregisterEvent=function(n){var r,i=function(n){t.hasOwnProperty(n)&&(delete t[n],fly.eventCtrlr.unsubscribe(n,e))};if(typeof n=="string")if(n==="all")for(r in t)t.hasOwnProperty(r)&&i(r);else i(n);else for(r in n)n.hasOwnProperty(r)&&i(r)},e.eventCall=function(n,r){if(t.hasOwnProperty(n)&&e.hasOwnProperty(t[n])){var i=t[n];this[i](r)}return e},e.logEvents=function(){return fly.toString(t)},e},fly.base=function(e){var t={};return t.name=e||"fly base",t.version="0.5beta",t.register=function(){return fly.infoCtrlr.register(this),this},fly.grantString(t),fly.grantInfo(t),fly.grantEvents(t),t},fly.eventCtrlr=function(){function a(e){var t;for(t in r)r[t]>0&&(r[t]=r[t]-1);r[e]=i}function f(e,t){fly.debug&&(a(e),e.match(s)&&(o=e));if(n[e])for(var r=0;r<n[e].length;r++)try{t!==undefined?n[e][r].eventCall(e,t):n[e][r].eventCall(e)}catch(i){d(i,n[e][r])}}function l(e,t){typeof e=="string"&&(e=[e]);for(var s=0,o=e.length;s<o;s++)n[e[s]]?n[e[s]].push(t):(n[e[s]]=[t],r[e[s]]=i)}function c(e,t){var r=function(e){for(var r=0,i=n[e].length;r<i;r++)n[e][r]===t&&n[e].splice(r,1),n[e].length===0&&delete n[e]};if(e==="all")for(var i in n)n.hasOwnProperty[i]&&r(i);else n.hasOwnProperty(e)&&r(e)}function h(){fly.infoCtrlr.register(this)}function p(){var i={name:e,v:{val:t,type:"version"},errors:{val:u.length,type:"val"}},s,a;for(s in n)if(n.hasOwnProperty(s)){r[s]>0?a="eventFiring":a="event";var f=n[s].length>1?" subscribers":" subscriber";i[s]={val:n[s].length+f,type:a}}return i.last_key={val:o,type:"string"},i}function d(e,t){var n="Error: ";e==="TypeError: events[e][i].eventCall is not a function"&&(t.info().name&&(n+=t.info().name),n+=" has no event call");for(var r=0;r<u.length;r++)if(u[r]===n)return;u.push(n)}var e="eventCtrlr",t="0.5beta",n={},r={},i=10,s=/.*-key$/,o="",u=[];return{publish:f,subscribe:l,unsubscribe:c,info:p,reqInfo:h,logErrors:function(){return fly.toString(u)},logEvents:function(){return fly.toString(n)}}}(),fly.grantString(fly.eventCtrlr),fly.initLayers=function(e,t){fly.layers={name:"layers",version:"0.5beta"},fly.layers.names=function(e,t){var n=t?["background"]:[],r;if(typeof e=="number"){if(e<1||e>100)e=1;for(r=0;r<e;r++)n.push("stage "+n.length)}else if(e instanceof Array)for(r=0;r<e.length;r++)typeof e[r]=="string"?n.push(e[r]):n.push("stage-"+n.length);return n}(e,t),fly.layers.stage=function(){var e=[],t;for(t=0;t<fly.layers.names.length;t++)t===0?e[t]=paper.project.activeLayer:e[t]=new paper.Layer;return e}();var n=new paper.Layer;fly.layers.stage.push(n),fly.layers.names.push("info"),fly.layer=function(e){return typeof e=="number"&&fly.layers.stage[e]?fly.layers.stage[e]:typeof e=="string"&&fly.layers.names.indexOf(e)>-1?fly.layers.stage[fly.layers.names.indexOf(e)]:!1},fly.layers.activate=function(e){fly.layer(e).activate()},fly.layers.info=function(){var e={},t=0,n=function(e){var t,n;return t=e.children.length,t+=t===1?" child":" children",n=e===paper.project.activeLayer?"btrue":"string",n==="btrue"&&(t+=" <active>"),{val:t,type:n}};e.name=this.name;for(t=0;t<fly.layers.names.length;t++)e[fly.layers.names[t]]=n(fly.layers.stage[t]);return e},fly.layers.toString=function(){var e="[",t;for(t=0;t<this.names.length;t++)e+='"'+this.names[t]+'",';return e=e.slice(0,-1),e+="]",e}},fly.color={name:"color",palette:"not yet defined"},fly.colorUtil={limit:function(e){return e=Math.min(Math.max(e,0),255),e},split:function(e){var t=e.slice(1);t=parseInt(t,16);var n=t>>16,r=t>>8&255,i=t&255;return[n,r,i]},splice:function(e){var t=e[0],n=e[1],r=e[2],i=(t<<16|n<<8|r).toString(16);while(i.length<6)i="0"+i;return i="#"+i,i},mix:function(e,t,n){n=n!==undefined?n:.5;var r=this.split(e),i=this.split(t);for(var s=0;s<r.length;s++)r[s]=r[s]*(1-n)+i[s]*n;return this.splice(r)},totalValue:function(e){var t=this.split(e);return t[0]+t[1]+t[2]},bispectrum:function(e,t,n){n=n!==undefined?n:5;if(n<3)return[e,t];var r=[e];for(var i=1;i<n-1;i++)r.push(this.mix(e,t,i/(n-1)));return r.push(t),r},trispectrum:function(e,t,n,r){r=r!==undefined?r:9;var i=Math.ceil(r/2),s=this.bispectrum(e,t,i),o=this.bispectrum(t,n,i);s.pop();var u=s.concat(o);return u},spectrum:function(e,t,n,r,i){fly.colorSets.push(e);var s;return r!==undefined&&(typeof r=="string"?s=this.trispectrum(t,n,r,i):typeof r=="number"?s=this.bispectrum(t,n,r):i=this.bispectrum(t,n)),s},background:function(e){if(!e)return fly.layers.backRect?fly.layers.backRect.fillColor:"none set";if(fly.layers&&fly.layer("background")){if(fly.layers.backRect===undefined){var t=paper.project.activeLayer;fly.layers.activate("background"),fly.layers.backRect=new paper.Path.Rectangle(paper.view.bounds),t.activate()}e=e!==undefined?e:"#FFFFFF",fly.layers.backRect.fillColor=e}}},fly.colorSets=[{name:"default",set:[["red","#400000","#FF0000","#FFC0C0"],["orange","#402900","#FFA500","#FFE8C0"],["yellow","#404000","#FFFF00","#FFFFC0"],["green","#004000","#00FF00","#C0FFC0"],["blue","#000040","#0000FF","#C0C0FF"],["purple","#400040","#800080","#FFC0FF"],["grey","#000000","#808080","#FFFFFF"]]},{name:"pastel",set:[["red","#F04510","#FF7070","#FFD3C0"],["orange","#F28614","#FFB444","#FFE8C0"],["yellow","#CDB211","#FFFF70","#FFFFC0"],["green","#42622D","#89C234","#C0FFC0"],["blue","#00597C","#00A9EB","#B0E5FF"],["purple","#6F006F","#9F3DBF","#FFC0FF"],["grey","#383633","#A7A097","#FFFFFF"]]},{name:"sunny day",set:[["red","#2F060D","#FF361F","#FFCFC5"],["orange","#6D3200","#FF8125","#FFD1B6"],["yellow","#D6FF43","#FFFA95","#F4FFDA"],["green","#3B4D2A","#89C234","#A0FFA0"],["blue","#1D3852","#00A9EB","#9BCAE1"],["purple","#4C244C","#893DB3","#D0B8FF"],["grey","#1E2421","#848179","#D3FFE9"]]},{name:"monotone",set:[["red","#1B1414","#584444","#FFE7E3"],["orange","#2A2620","#4D463A","#FFE9CC"],["yellow","#313125","#808061","#FAFFE0"],["green","#111611","#6E936E","#E7FFD3"],["blue","#0A0A0D","#696991","#E5D9FF"],["purple","#0D090D","#684E68","#FFE3EC"],["grey","#000000","#808080","#FFFFFF"]]},{name:"neon",set:[["red","#6A0032","#FF0023","#FFC0F2"],["orange","#BD2E00","#FFA500","#FFE8C0"],["yellow","#ACFF02","#FFFF00","#FFFFC0"],["green","#133B0F","#38FF41","#BFFF68"],["blue","#010654","#013BFF","#4FFFF8"],["purple","#3B034C","#9800B3","#CC5FFF"],["grey","#0A0511","#696281","#E3E8FF"]]}],fly.colorPalette=function(e){function r(e){if(!e.name||!e.set)return"Palette must have a name and a set";if(typeof e.name!="string")return"Palette name must be string";if(e.set instanceof Array==0)return"Palette set must be an array";for(t=0;t<e.set.length;t++){if(e.set[t]instanceof Array==0||e.set[t].length!==4)return"Palette set of unknown type";var n=/palette|info|addInfo|deleteInfo/;if(e.set[t][0].match(n))return e.set[t][0]+" is a reserved word in color sets"}return!0}function i(e){for(t=0;t<fly.colorSets.length;t++)if(fly.colorSets[t].name===e)return t;return-1}function s(){var t;if(typeof e=="object"&&e.name&&e.set){t=r(e);if(t!==!0)throw new TypeError(t);n=i(e.name),n===-1?(n=fly.colorSets.length,fly.colorSets.push(e)):fly.colorSets[n].set=e.set}else{if(typeof e!="string")return new TypeError("Unknown type sent as args to color palette");n=i(e),n===-1&&(n=0)}}function o(e){fly.color={name:"color",palette:e.name};var t={palette:{val:"palette",type:"val"}},n,r;for(var i=0;i<e.set.length;i++)n=e.set[i],r=n[1]+"-"+n[2]+"-"+n[3],t[n[0]]={val:r,type:"string"};fly.grantInfo(fly.color).addInfo(t)}function u(){var e,r;try{s()}catch(i){if(fly.color.palette!=="not yet defined")return i;n=0}r=fly.colorSets[n],o(r);for(t=0;t<r.set.length;t++)e=r.set[t],fly.color[e[0]]=fly.colorUtil.spectrum(e[0],e[1],e[2],e[3])}var t,n=-1;if(!e)return fly.color.palette;u()},fly.infoCtrlrInit=function(e){var t,n;fly.infoCtrlr=function(e){function d(e,t){t=typeof t!="undefined"?t:!1;for(var n=0;n<r.length;n++)if(r[n].obj===e)return"error: object already exists";r.push({obj:e,display:t,info:{}}),O(!0),b()}function v(e){for(var t=0;t<r.length;t++)if(r[t].obj===e){r.splice(t,1);return}m()}function m(){f.txtWidth=0,O(!0),b()}function g(e,t){if(e===undefined||t===undefined)return"Error printing info";L(e,t);var n=new paper.PointText(f.cursor);n.paragraphStyle.justification="left",n.characterStyle.fontSize=s.size;var r="";if(t==="openTitle")r+="▼  "+e,n.fillColor=s.titles;else if(t==="closedTitle")r+="▶ "+e,n.fillColor=s.titles,f.cursor.y+=2;else{var i;t.type==="bool"?i="b"+t.val:i=t.type,s[i]!==undefined?n.fillColor=s[i]:n.fillColor=s.plain,r+=e+": "+t.val}n.content=r,l.txt.addChild(n),f.cursor.y+=s.spacing}function y(){f.cursor=new paper.Point(f.txtOrigin);for(var e=0;e<r.length;e++){w();if(r[e].display===!0){g(r[e].info.name,"openTitle");for(var t in r[e].info)t!=="name"&&g(t,r[e].info[t])}else g(r[e].info.name,"closedTitle")}}function b(){f.titleBars=[]}function w(){if(f.titleBars.length!==r.length){var e=new paper.Point(f.cursor.x-s.offset,f.cursor.y-1.2*s.offset);f.titleBars.push(e)}}function E(){for(var e=0;e<f.titleBars.length;e++){var t=new paper.Size(f.txtWidth+2*s.offset,s.spacing),n=new paper.Path.Rectangle(f.titleBars[e],t);n.fillColor=s.screenBars,n.opacity=.5,l.bars.addChild(n)}}function S(){var e=new paper.Size(f.boxWidth,30),t=new paper.Path.Rectangle(f.origin,e);t.name="grip",t.fillColor=s.plain,t.visible=!1,l.box.addChild(t);for(var n=0;n<7;n++){var r=new paper.Point(f.origin.x,f.origin.y+.3*s.size*n+2),i=new paper.Point(r.x+f.boxWidth,r.y),o=new paper.Path.Line(r,i);o.strokeColor=s.screenBars,o.strokeWidth=2,l.box.addChild(o)}}function x(){f.txtWidth=f.txtLen*s.size*.68,f.boxWidth=f.txtWidth+2*s.offset;var e=new paper.Size(f.boxWidth,f.cursor.y-f.origin.y-s.offset),t=new paper.Rectangle(f.origin,e),n=new paper.Path.RoundRectangle(t,10),r=new paper.Path.Rectangle(t);r.fillColor=s.screen,r.opacity=s.opacity,l.box.addChild(n),l.box.addChild(r),l.box.clipped=!0,S(),E(),fly.layer("info").visible=f.visible}function T(){if(fly.debug){f.visible=!f.visible;if(f.origin.x<1||f.origin.x>fly.height||f.origin.y<1||f.origin.y>fly.width)f.origin.x=10,f.origin.y=10,f.txtOrigin=f.origin.add(f.txtOffset),b()}}function N(e){var t=e.point;if(!fly.layer("info").visible)return;for(var n=0;n<l.bars.children.length;n++)l.bars.children[n].hitTest(t)&&(r[n].display=!r[n].display,m());l.box.children.grip.hitTest(t)&&(f.handle.or=t.subtract(f.origin),c=!0)}function C(e){var t=e.point;c&&(f.origin=t.subtract(f.handle.or),f.txtOrigin=f.origin.add(f.txtOffset),b())}function k(e){var t=e.point;c=!1}function L(e,t){e=e||0,t=t||0,e=e.toString()||0,t=t.toString()||0;var n=e.length+t.length;n>f.txtLen&&(f.txtLen=n),f.txtLen>50&&(f.txtLen=50)}function A(e){h.frame=e.count,h.time=e.time,e.time-h.refresh>.1&&(h.refresh=e.time,h.fps.avg=h.frame/h.time,h.fps.curr=1/e.delta)}function O(e){for(var t=0;t<r.length;t++)if(r[t].display||e){r[t].info=r[t].obj.info();if(e){var n;for(n in r[t].info)if(r[t].info.hasOwnProperty(n))try{n==="name"?L("name",r[t].info.name):L(n,r[t].info[n].val)}catch(i){return i}}}}function M(e){A(e);if(fly.layer("info").visible||f.visible)l.box.hasChildren()&&l.box.removeChildren(),l.bars.hasChildren()&&l.bars.removeChildren(),l.txt.hasChildren()&&l.txt.removeChildren(),O(),y(),x()}var t="Info Controller",n="0.5beta",r=[{obj:fly,display:!1},{obj:fly.eventCtrlr,display:!1},{obj:fly.layers,display:!1},{obj:fly.color,display:!1}];e=e||{},fly.color.palette==="not yet defined"&&fly.colorPalette("default");var i=e.keyTrigger||"i-key",s={},o=!0,u=["blue","grey","green","orange","red","purple"];for(var a=0;a<u.length;a++)if(!fly.color[u[a]]||fly.color[u[a]].length<8){o=!1;break}o?(s.titles=e.titleBar||fly.color.blue[7],s.plain=fly.color.grey[4]||"#89C234",s.screen=e.screen||fly.color.grey[1],s.screenBars=e.screenBars||fly.color.grey[0],s.val=e.val||fly.color.green[2],s.string=e.string||fly.color.grey[4],s.btrue=e.btrue||fly.color.orange[6],s.bfalse=e.bfalse||fly.color.orange[3],s.event=e.event||fly.color.red[4],s.eventFiring=e.eventFiring||fly.color.red[7],s.version=e.version||fly.color.grey[5],s.info=e.info||fly.color.blue[7]):(s.titles=e.titleBar||"#9BCAE1",s.plain="#89C234",s.screen=e.screen||"#0D1927",s.screenBars=e.screenBars||"black",s.val=e.val||"#89C234",s.string=e.string||"#691BE2",s.btrue=e.btrue||"#66FF99",s.bfalse=e.bfalse||"#3D9199",s.event=e.event||"#BC4500",s.eventFiring=e.eventFiring||"#FF5E00",s.version=e.version||"#8A8A39",s.info=e.info||"#CCB599"),s.size=e.size||11,s.spacing=s.size*1.75,s.offset=s.size,s.opacity=e.opacity||.95;var f={};f.handle={},f.origin=new paper.Point(10,10),f.txtOffset=[s.size,s.size*3.5],f.txtOrigin=f.origin.add(f.txtOffset),f.txtLen=0,f.txtWidth=0,f.titleBars=[],f.visible=fly.debug;var l=[];l.box=new paper.Group,l.bars=new paper.Group,l.txt=new paper.Group;var c=!1,h={};h.refresh=0,h.frame=0,h.time=0,h.fps={curr:0,avg:0};var p={};return p.isIpad=navigator.userAgent.match(/iPad/)!==null,p.isMobile=function(){var e=navigator.userAgent.toLowerCase(),t=/android|webos|iphone/;return e.match(t)?!0:!1}(),{name:t,version:n,"key trigger":i,members:r,numMembers:function(){return r.length},frame:function(){return h.frame},time:function(){return h},"time passed":function(){return h.time.toFixed(1)},fps:function(){return h.fps.curr.toFixed(1)},fpsAvg:function(){return h.fps.avg.toFixed(1)},moving:function(){return c},isMobile:function(){return p.isMobile},isIpad:function(){return p.isIpad},update:M,register:d,deregister:v,toggleDisplay:T,grab:N,drag:C,drop:k}}(e),fly.grantString(fly.infoCtrlr),fly.grantInfo(fly.infoCtrlr).addInfo({"key trigger":{val:"key trigger",type:"val"},members:{val:"numMembers",type:"func"},"time passed":{val:"time passed",type:"func"},"frames per second":{val:"fps",type:"func"},"fps average":{val:"fpsAvg",type:"func"},mobile:{val:"isMobile",type:"func"},ipad:{val:"isIpad",type:"func"}}),fly.infoCtrlr.register(fly.infoCtrlr),t={frame:"update","mouse down":"grab","mouse drag":"drag","mouse up":"drop"},n=fly.infoCtrlr["key trigger"],t[n]="toggleDisplay",fly.grantEvents(fly.infoCtrlr).registerEvent(t),fly.infoCtrlr.toggleDisplay()},fly.initPaperTool=function(){fly.tool=new paper.Tool,fly.tool.onKeyDown=function(e){var t="";e.key.length===1&&(e.modifiers.shift===!0&&(t+="shift-"),e.modifiers.control===!0&&(t+="control-"),e.modifiers.option===!0&&(t+="option-"),e.modifiers.command===!0&&(t+="command-"),e.modifiers.capsLock===!0&&(t+="capsLock-")),t+=e.key+"-key";var n=fly.eventCtrlr.publish(t)},fly.tool.onMouseDown=function(e){fly.eventCtrlr.publish("mouse down",e)},fly.tool.onMouseDrag=function(e){fly.eventCtrlr.publish("mouse drag",e)},fly.tool.onMouseUp=function(e){fly.eventCtrlr.publish("mouse up",e)},fly.tool.onMouseMove=function(e){fly.eventCtrlr.publish("mouse move",e)}},fly.init=function(e){e===undefined&&(e={}),fly.debug=e.debug||!1;var t=e.layers||1,n=e.background||!0,r=e.colorPalette||"default",i=e.infoPrefs||{};e.width&&e.height?(fly.width=e.width,fly.height=e.height,paper.view.viewSize=new paper.Size(fly.width,fly.height)):(fly.width=paper.view.viewSize.width,fly.height=paper.view.viewSize.height),fly.foo="foo",fly.grantInfo(fly).addInfo({debug:{val:"debug",type:"val"},width:{val:"width",type:"val"},height:{val:"height",type:"val"}}),fly.initLayers(t,n),fly.colorPalette(r),fly.infoCtrlrInit(i),fly.layer("background")?fly.layers.activate(1):fly.layers.activate(0),fly.initPaperTool()},fly.midpoint=function(e,t){var n=new paper.Point(e.add(t));return n=n.divide([2,2]),n},fly.scatter=function(e,t){e instanceof Array==0&&(e=[e]);for(var n=0;n<e.length;n++){var r=new paper.Point(t.width,t.height),i=r.multiply(paper.Size.random());e[n].position=t.point.add(i)}},fly.randomizePt=function(e,t,n){var r=n||"none";if(r!=="y"){var i=-t+2*t*Math.random();e.x+=i}if(r!=="x"){var s=-t+2*t*Math.random();e.y+=s}return e},fly.eachCell=function(e,t){for(var n=0;n<e.cols;n++)for(var r=0;r<e.rows;r++)t(e,n,r)},fly.gridPlot=function(e,t,n,r){r=r||"down-left";var i=new paper.Path.Rectangle(n),s=[];for(var o=0;o<=e;o++)s[o]=[];var u=i.bounds.width/e,a=i.bounds.height/t;for(var f=0;f<=e;f++)for(var l=0;l<=t;l++){var c=new paper.Point(i.bounds.x+f*u,i.bounds.y+l*a);switch(r){case"down-right":case"right":s[e-f][l]=c;break;case"up-left":s[f][t-l]=c;break;case"up-right":s[e-f][t-l]=c;break;default:s[f][l]=c}}return s},fly.initArray=function(e,t){var n=[];for(var r=0;r<e;r++){n[r]=[];for(var i=0;i<t;i++)n[r][i]=[]}return n},fly.Scroll=function(e){e=e||{},this.name=e.name+" scroll"||"scroll",this.version="0.4 Beta",this.position=e.position||new paper.Point(0,0),this.direction=e.direction||"left",this.speed=e.speed!==undefined?e.speed:5,this.curSpeed=0,this.repeat=e.repeat||!0,this.reset=!1,this.resetAt=e.resetAt||fly.width,this.resetPos=e.resetPos||this.position,this.register()},fly.Scroll.prototype.info=function(){var e={};return e.name=this.name,e.version={val:this.version,type:"version"},e.position={val:this.position,type:"val"},e.speed={val:this.speed,type:"val"},e.curSpeed={val:this.curSpeed,type:"val"},e.direction={val:this.direction,type:"val"},e.repeat={val:this.repeat,type:"bool"},e.reset={val:this.reset,type:"bool"},e},fly.Scroll.prototype.register=function(){fly.debug&&fly.infoCtrlr.register(this)},fly.Scroll.prototype.update=function(e){this.curSpeed=e.delta*this.speed*8;switch(this.direction){case"up":this.position.y-=this.curSpeed,this.position.y<this.resetAt&&(this.reset=!0);break;case"down":this.position.y+=this.curSpeed,this.position.y>this.resetAt&&(this.reset=!0);break;case"right":this.position.x-=this.curSpeed,this.position.x<this.resetAt&&(this.reset=!0);break;default:this.position.x+=this.curSpeed,this.position.x>this.resetAt&&(this.reset=!0)}this.reset===!0&&(this.position=new paper.Point(this.resetPos),this.reset=!1)},fly.Scroll.prototype.reposition=function(e){this.position=new paper.Point(e)},fly.Bob=function(e){e=e||{},this.name=e.name+"'s motion: bob"||"bob",this.version="0.4",this.position=new paper.Point(e.position)||new paper.Point(0,0),this.origin=new paper.Point(this.position),this.speed=e.speed!==undefined?e.speed:5,this.delta=e.delta!==undefined?e.delta:33,this.register()},fly.Bob.prototype.info=function(){var e={};return e.name=this.name,e.version={val:this.version,type:"version"},e.position={val:"x: "+this.position.x.toFixed(0)+", y: "+this.position.y.toFixed(0),type:"val"},e.speed={val:this.speed,type:"val"},e.delta={val:this.delta,type:"val"},e},fly.Bob.prototype.register=function(e){fly.debug&&(e=e||!1,fly.infoCtrlr.register(this,e))},fly.Bob.prototype.reposition=function(e){this.position=new paper.Point(e)},fly.Bob.prototype.move=function(e){this.origin=new paper.Point(e)},fly.Bob.prototype.update=function(e){var t=new paper.Point(this.origin),n=Math.sin(e.time*this.speed)*this.delta;t.y+=n,this.reposition(t)},fly.Swing=function(e){e=e||{name:"",maxRotation:90,decay:0,timestep:.01},this.name=e.name+" swing"||"swing",this.version="0.3.3",this.maxR=e.maxRotation||90,this.decay=1+e.decay/1e3||1,this.velocity=3,this.angle=0,this.deg=0,this.gravity=10,this.l=1,this.k=-this.gravity/this.l,this.timestep=e.timestep||1e-4,this.acceleration=0,this.register()},fly.Swing.prototype.info=function(){var e={};return e.name=this.name,e.version={val:this.version,type:"version"},fly.debug&&(e.length={val:this.l.toFixed(2),type:"val"},e.timestep={val:this.timestep.toFixed(3),type:"val"},e.decay={val:this.decay,type:"val"},e.velocity={val:this.velocity.toFixed(0),type:"val"},e.angle={val:this.angle.toFixed(0),type:"val"},e.degree={val:this.deg.toFixed(0),type:"val"},e.acceleration={val:this.acceleration.toFixed(0),type:"val"}),e},fly.Swing.prototype.add=function(){this.velocity>0?this.velocity+=this.force/10:this.velocity<0&&(this.velocity-=this.force/10)},fly.Swing.prototype.update=function(){this.acceleration=this.k*Math.sin(this.angle),this.velocity+=this.acceleration*this.timestep,this.angle+=this.velocity*this.timestep,this.decay&&(this.velocity/=this.decay)},fly.Swing.prototype.rotation=function(){return this.deg=this.angle*this.maxR,this.deg>0&&this.deg>this.maxR?(this.deg=this.maxR,this.velocity=0):this.deg<0&&this.deg<-this.maxR&&(this.deg=-this.maxR,this.velocity=0),this.deg.toFixed(2)},fly.Ananda=function(){this.version===undefined&&(this.version="0.3.6"),this.name===undefined&&(this.name="Ananda ")},fly.Ananda.prototype.init=function(e){function n(){t.Pt===undefined&&(t.Pt=new paper.Point(0,0)),t.Sz===undefined&&(t.Sz=new paper.Size(t.ds,t.ds)),t.Rect===undefined&&(t.Rect=new paper.Rectangle(t.Pt,t.Sz)),t.handle=new paper.Path.Rectangle(t.Rect),t.handle.selected=!1,t.handle.style=t.style||{fillColor:"white"},t.handle.visible=t.visible||!1}function r(r){e<0?(t.n="born",t.Sz=new paper.Size(100,100),n()):(t.n="Numborn",t.Sz=new paper.Size(r,r),n()),t.bld+="n("+r+")"}function i(e){t.n=e,t.bld+="s("+e+")"}function s(e){t.n="NArrborn",t.bld+="a[";switch(e.length){case 0:return;case 1:t.bld+=e[0],r(e[0]);return;case 2:t.bld+=e[0]+"."+e[1],t.Sz=new paper.Size(e[0],e[1]);break;case 3:t.bld+=e[0]+"."+e[1]+"."+e[2],t.Pt=new paper.Point(e[0],e[1]),t.Sz=new paper.Size(e[2],e[2]);break;case 4:t.bld+=e[0]+"."+e[1]+"."+e[2]+"."+e[3],t.Pt=new paper.Point(e[0],e[1]),t.Sz=new paper.Size(e[2],e[3])}t.bld+="]",n()}function o(e){var n=!0;for(var r=0;r<e.length;r++)if(typeof e[r]!="number"){n=!1;break}n?s(e):t.n="errorArray"}function u(e){t.Rect=new paper.Rectangle(e)}function a(e){typeof e=="number"?r(e):e instanceof Array?o(e):typeof e=="object"&&e.x!==undefined&&e.y!==undefined&&e.width!==undefined&&e.height!==undefined&&u(e),n()}function f(e){e.style&&(t.style=e.style),e.visible&&(t.visible=e.visible),e.handle&&a(e.handle),e.name?i(e.name):t.n="Objborn"}e=typeof e!="undefined"?e:-1;var t={};t.n="",t.bld="",t.ds=50;switch(typeof e){case"number":r(e);break;case"string":i(e);break;case"object":e instanceof Array?o(e):f(e);break;default:t.n="errNoType"}this.name=t.n,this.buildRecord=t.bld,this.selectable=e.selectable!==undefined?e.selectable:!1,this.dragable=e.dragable!==undefined?e.dragable:!0,this.rotatable=e.rotatable!==undefined?e.rotatable:!1,this.moving=!1,this.group=new paper.Group,t.handle&&(this.handle=t.handle,this.handle.name="handle",this.group.addChild(this.handle))},fly.Ananda.prototype.info=function(){var e=this.anandaInfo();return e},fly.Ananda.prototype.anandaInfo=function(){var e={};return e.name=this.name,e.version={val:this.version,type:"version"},fly.debug&&(e.build={val:this.buildRecord,type:"string"},this.handle&&(e.point={val:this.handle.bounds.x.toFixed(2)+" x "+this.handle.bounds.y.toFixed(2),type:"val"},e.size={val:this.handle.bounds.width.toFixed(2)+" x "+this.handle.bounds.height.toFixed(2),type:"val"}),e.group={val:this.group._children.length,type:"val"},e.dragable={val:this.dragable,type:"bool"},e.moving={val:this.moving,type:"bool"},e.selectable={val:this.selectable,type:"bool"},e.selected={val:this.group.selected,type:"bool"},e.rotatable={val:this.rotatable,type:"val"}),e},fly.Ananda.prototype.register=function(e){e=e||!1,fly.infoCtrlr.register(this,e),fly.eventCtrlr.subscribe(["mouse down","mouse drag","mouse up","frame","r-key","s-key"],this)},fly.Ananda.prototype.updateHandle=function(e){var t=e||this.handle.bounds,n=this.handle.style,r=this.handle.opacity,i=this.handle.visible;this.handle.remove(),this.handle=new paper.Path.Rectangle(t),this.group.selected===!0&&(this.handle.selected=!0),this.handle.style=n,this.handle.opacity=r,this.handle.visible=i,this.group.addChild(this.handle)},fly.Ananda.prototype.toggleDisplay=function(){this.group.visible=!this.group.visible},fly.Ananda.prototype.toggleSelected=function(){fly.debug&&this.selectable&&(this.group.selected=!this.group.selected)},fly.Ananda.prototype.grab=function(e){this.handle?this.handle.hitTest(e.point)&&(this.moveOrigin=e.point.subtract(this.handle.bounds.center),this.moving=!0):this.group.hitTest(e.point)&&(this.moveOrigin=e.point.subtract(this.group.bounds.center),this.moving=!0)},fly.Ananda.prototype.drag=function(e){this.moving&&this.dragable&&fly.infoCtrlr.moving()===!1&&(this.group.position=e.point.subtract(this.moveOrigin))},fly.Ananda.prototype.drop=function(e){this.moving=!1},fly.Ananda.prototype.rotate=function(e){this.rotatable&&(e=e||3,this.group.rotate(e,this.handle.bounds.center))},fly.Ananda.prototype.update=function(e){},fly.Ananda.prototype.eventCall=function(e,t){switch(e){case"r-key":this.rotate();break;case"s-key":this.toggleSelected();break;case"frame":this.update(t);break;case"mouse down":this.grab(t);break;case"mouse drag":this.drag(t);break;case"mouse up":this.drop(t);break;default:}},fly.Pullbar=function(e){this.version="0.4",e=e||{},e.name=e.name+"'s pullbar"||"pullbar",e.handle===undefined&&(e.handle=10),fly.Ananda.call(this),this.init(e),this.fixLength=e.fixLength||!1,this.fixAngle=e.fixAngle||!1,this.vectorCtr=e.vectorCtr||new paper.Point(paper.view.center),this.vector=e.vector||new paper.Point(0,0),this.color=e.color||"#E4141B",this.selected=e.selected||!1,this.vectorPrevious=this.vector,this.joints=[],this.build(),this.draw(),this.moving=!1,this.register()},fly.Pullbar.prototype=new fly.Ananda,fly.Pullbar.prototype.constructor=fly.Pullbar,fly.Pullbar.prototype.info=function(){var e=this.anandaInfo(),t={};return t.name=e.name,t.moving=e.moving,t.selected={val:this.selected,type:"bool"},fly.debug&&(t.fixedLength={val:this.fixLength,type:"bool"},t.fixedAngle={val:this.fixAngle,type:"bool"},t.vectorStart={val:this.vectorCtr,type:"val"},t.vector={val:this.vector,type:"val"},this.vector&&(t.vectorLength={val:this.vector.length.toFixed(2),type:"val"},t.vectorAngle={val:this.vector.angle.toFixed(2),type:"val"}),t.vectorPrevious={val:this.vectorPrevious,type:"val"}),t},fly.Pullbar.prototype.register=function(e){e=e||!1,fly.infoCtrlr.register(this,e),fly.eventCtrlr.subscribe(["mouse down","mouse drag","mouse up","s-key"],this)},fly.Pullbar.prototype.toggleSelected=function(e){e!==undefined?this.selected=e:this.selected=!this.selected,this.group.visible=this.selected},fly.Pullbar.prototype.locate=function(e){return this.vectorCtr=e||this.vectorCtr,this.joints[0]=this.vectorCtr,this.joints[1]=this.vectorCtr.add(this.vector),this.joints[2]=this.vectorCtr.subtract(this.vector),this.handle.position=this.joints[1],this.handle.bounds.center},fly.Pullbar.prototype.reposition=function(e){this.locate(e),this.draw()},fly.Pullbar.prototype.build=function(){this.locate(),this.bones=[],this.bones[0]=new paper.Path.Circle(this.joints[0],3),this.bones[1]=new paper.Path([this.joints[0],this.joints[1]]),this.bones[1].strokeWidth=1.75,this.bones[1].strokeColor="#e4141b";var e=new paper.Path.Oval(this.handle.bounds),t=e.clone();t.scale(.5,t.bounds.center),this.bones[2]=new paper.Group([e,t]),this.bones[3]=this.bones[2].clone(),this.bones[3].position=this.joints[1];for(var n=0;n<this.bones.length;n++)this.bones[n].strokeWidth=1.75,this.bones[n].strokeColor=this.color,this.bones[n].fillColor="white";this.bones[0].fillColor=this.color,this.handle.remove(),this.group.addChildren(this.bones),this.group.visible=this.visible},fly.Pullbar.prototype.processVector=function(e){this.vector=e.subtract(this.vectorCtr),this.vectorPrevious&&(this.fixLength&&this.fixAngle?this.vector=this.vectorPrevious:this.fixLength?this.vector.length=this.vectorPrevious.length:this.fixAngle&&(this.vector=this.vector.project(this.vectorPrevious))),this.locate(),this.draw()},fly.Pullbar.prototype.draw=function(){this.bones[0].position=this.joints[0],this.bones[1].segments[0].point=this.joints[1],this.bones[1].segments[1].point=this.joints[2],this.bones[2].position=this.joints[1],this.bones[3].position=this.joints[2]},fly.Pullbar.prototype.grab=function(e){this.selected&&(this.bones[2].hitTest(e.point)||this.bones[3].hitTest(e.point))&&(this.moving=!0,this.processVector(e.point))},fly.Pullbar.prototype.drag=function(e){this.moving===!0&&(!e.modifiers.shift&&this.fixLength&&this.fixAngle&&(this.vectorCtr=e.point),this.processVector(e.point))},fly.Pullbar.prototype.drop=function(e){this.moving===!0&&(this.processVector(e.point),this.vectorPrevious=this.vector,this.moving=!1)};